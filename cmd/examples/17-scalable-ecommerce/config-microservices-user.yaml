# Microservices Deployment - User Service
# User management and authentication service

configs:
  - name: deployment-type
    value: "microservices"
  - name: service-name
    value: "user-service"
  - name: product-service-url
    value: "${PRODUCT_SERVICE_URL:http://localhost:8081}"
  - name: payment-service-url
    value: "${PAYMENT_SERVICE_URL:http://localhost:8084}"
  - name: analytics-service-url
    value: "${ANALYTICS_SERVICE_URL:http://localhost:8085}"
  - name: cors-origins
    value: "${CORS_ORIGINS:*}"
  - name: rate-limit-rps
    value: 300
  - name: cache-ttl-seconds
    value: 900  # Longer cache for user data
  - name: enable-cache
    value: true
  - name: database-url
    value: "${USER_DB_URL:postgres://localhost:5432/users}"
  - name: database-pool-size
    value: 10
  - name: redis-url
    value: "${USER_REDIS_URL:redis://localhost:6379/2}"

middlewares:
  - name: logging
    type: logging
  - name: cors
    type: cors
  - name: auth
    type: auth
  - name: rate-limit
    type: rate-limit
  - name: cache
    type: cache

services:
  - name: database
    type: database
  - name: redis
    type: redis
  # Business services - will use HTTP clients in microservices
  - name: product-service
    type: product-service
  - name: user-service
    type: user-service
  - name: payment-service
    type: payment-service
  - name: analytics-service
    type: analytics-service

routers:
  - name: user-api
    use: [logging, cors, auth, cache]
    routes:
      - name: users-list
        use: [rate-limit]

servers:
  - name: user-service
    listen: "${USER_PORT:8083}"
    services: [database, redis, product-service, user-service, payment-service, analytics-service]
    apps:
      - name: user-app
        addr: "/"
        routers: [user-api]