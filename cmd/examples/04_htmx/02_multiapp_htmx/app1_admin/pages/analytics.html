<!-- layout: admin.html -->
<!-- title: Analytics Dashboard -->

<div class="analytics-page">
    <div class="page-header">
        <h2>Analytics Dashboard</h2>
        <div class="time-range-selector">
            <button class="btn btn-sm" hx-get="/app1/api/analytics?range=1d" hx-target="#analytics-content">Last 24h</button>
            <button class="btn btn-sm active" hx-get="/app1/api/analytics?range=7d" hx-target="#analytics-content">Last 7 days</button>
            <button class="btn btn-sm" hx-get="/app1/api/analytics?range=30d" hx-target="#analytics-content">Last 30 days</button>
        </div>
    </div>

    <div id="analytics-content">
        <!-- Key Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <h3>{{.analytics.page_views}}</h3>
                <p>Page Views</p>
                <div class="metric-chart">üìà +{{.analytics.page_views_change}}%</div>
            </div>
            
            <div class="metric-card">
                <h3>{{.analytics.unique_visitors}}</h3>
                <p>Unique Visitors</p>
                <div class="metric-chart">üë• +{{.analytics.visitors_change}}%</div>
            </div>
            
            <div class="metric-card">
                <h3>{{.analytics.avg_session}}</h3>
                <p>Avg. Session Duration</p>
                <div class="metric-chart">‚è±Ô∏è {{.analytics.session_change}}</div>
            </div>
            
            <div class="metric-card">
                <h3>{{.analytics.bounce_rate}}%</h3>
                <p>Bounce Rate</p>
                <div class="metric-chart">üìä {{.analytics.bounce_change}}%</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-card">
                <h3>Traffic Over Time</h3>
                <div class="chart-placeholder">
                    <div class="chart-bars">
                        {{range .analytics.traffic_data}}
                        <div class="chart-bar" style="height: {{.percentage}}%">
                            <span class="bar-value">{{.value}}</span>
                        </div>
                        {{end}}
                    </div>
                    <div class="chart-labels">
                        {{range .analytics.traffic_labels}}
                        <span>{{.}}</span>
                        {{end}}
                    </div>
                </div>
            </div>

            <div class="chart-card">
                <h3>Top Pages</h3>
                <div class="top-pages-list">
                    {{range .analytics.top_pages}}
                    <div class="page-item">
                        <div class="page-info">
                            <span class="page-url">{{.url}}</span>
                            <span class="page-title">{{.title}}</span>
                        </div>
                        <div class="page-stats">
                            <span class="page-views">{{.views}} views</span>
                            <div class="page-bar">
                                <div class="page-bar-fill" style="width: {{.percentage}}%"></div>
                            </div>
                        </div>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>

        <!-- Real-time Stats -->
        <div class="realtime-section">
            <h3>Real-time Activity</h3>
            <div class="realtime-stats" 
                 hx-get="/app1/api/analytics/realtime" 
                 hx-trigger="load, every 5s"
                 hx-indicator=".realtime-loading">
                <div class="realtime-loading htmx-indicator">Loading real-time data...</div>
            </div>
        </div>
    </div>
</div>