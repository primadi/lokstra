# yaml-language-server: $schema=https://lokstra.dev/schema/lokstra.json

# Monolith Multi Port Deployment
# All services on same server, different ports
# Best for: Staging, testing service isolation
# Performance: Fast (local HTTP calls, no external network)

services:
  # Infrastructure Layer
  - name: db
    type: DBService

  - name: cache
    type: CacheService

  # Repository Layer
  - name: product-repo
    type: ProductRepository
    config:
      db_service: db
      cache_service: cache

  - name: order-repo
    type: OrderRepository
    config:
      db_service: db
  
  # Business Logic Layer
  - name: product-svc
    type: ProductService
    config:
      repo_service: product-repo

  - name: order-svc
    type: OrderService
    config:
      repo_service: order-repo

servers:
  - name: product-server
    deployment-id: product-monolith
    baseUrl: "http://localhost:8081"
    apps:
      - addr: :8081
        routers: [product-api, health-api]
  
  - name: order-server
    deployment-id: order-monolith
    baseUrl: "http://localhost:8082"
    apps:
      - addr: :8082
        routers: [order-api, health-api]
